#!/usr/bin/env python3

import warnings
warnings.filterwarnings("ignore", category=UserWarning, module="pydantic._internal._config")
import sys
from deep_translator import GoogleTranslator
import cohere
import anthropic
from openai import OpenAI
import os
import subprocess


client_oi = OpenAI(api_key=os.environ["OPENAI_API_KEY"])
modelSource = "gpt-5.1"

co = cohere.Client(os.environ["COHERE_API_KEY"])
modelco= 'command-a-03-2025'

client_an = anthropic.Anthropic()
model = "claude-sonnet-4-5-20250929"


translator = GoogleTranslator(source='en', target='iw')
input_text = ' '.join(sys.argv[1:])  # Join all command-line arguments after the script name

# trans (translate-shell)
try:
    result = subprocess.run(['trans', '-t', 'iw', '-b', '--no-bidi', input_text], 
                          capture_output=True, text=True, timeout=5)
    if result.returncode == 0 and result.stdout.strip():
        print("translate-shell:")
        print(" " + result.stdout.strip())
except Exception as e:
    pass

# deep-translator (command-line)
try:
    result = subprocess.run(['deep-translator', '--source', 'en', '--target', 'iw', '--text', input_text], 
                          capture_output=True, text=True, timeout=5)
    if result.returncode == 0 and result.stdout.strip():
        # Extract only the translation result after "Translation result:"
        output = result.stdout.strip()
        if "Translation result:" in output:
            translation = output.split("Translation result:")[-1].strip()
            print("deep-translator:")
            print(" " + translation)
        else:
            print("deep-translator:")
            print(" " + output)
except Exception as e:
    pass

# googletrans library
try:
    from googletrans import Translator
    gt = Translator()
    result = gt.translate(input_text, dest='iw').text
    if result:
        print("googletrans library:")
        print(" " + result)
except Exception as e:
    pass

try:
    result = translator.translate(input_text)
    if result:
        print("google:\n",result)
    else:
        print("Translation failed. No text returned.")
except Exception as e:
    print("Translation failed. Error:", str(e))


try:
    text=""
    token_count=0
    for event in co.chat(
            model=modelco,
            message="translate this to hebrew: "+input_text,
            temperature=0.7,
            stream=True,
            preamble="""you are transaltor expert in english and hebrew. 
            you going to translate from english to hebrew.
            your respond should be only the translate nothing else.
            i need you to think on the context from user not just colde translate. 
            i also need you figure sland of people . dont just transalte words but think how they use it and that translte. 
              """
        ):

        if event.event_type == "text-generation":
            response_tokens = len(event.text.split())  # Estimate token count
            token_count += response_tokens
            text+=event.text
        elif event.event_type == "stream-end":
            break
    
    print("cohere:")
    print(" "+text, end='', flush=True)  # Print each piece on the same line
    print("")
except Exception as e:
    pass
    #print("Translation failed. Error:", str(e))


try: 
    text=""  
    with client_an.messages.stream(
        model=model,
        max_tokens=4000,
        system=f"""
             you are transaltor expert in english and hebrew. 
             you going to translate from english to hebrew.
             your respond should be only the translate nothing else.
             i need you to think on the context from user not just colde translate. 
             i also need you figure sland of people . dont just transalte words but think how they use it and that translte.         
        """,
         messages=[
            {
                "role": "user", 
                "content": "translate this to hebrew: "+input_text,
            },
            
        ],
         temperature=0.9
        ) as stream:
            for te in stream.text_stream:
                text+=te
        
    print("claude translate:")
    print(text, end='', flush=True)
    print("")
except Exception as e:
    if "credit balance" not in str(e).lower():
        pass
    # Silently skip if no credits

try:
    text=""
    response = client_oi.chat.completions.create(
    model=modelSource,
    messages=[
        {
            'role': 'system',
            'content': f"""
             you are transaltor expert in english and hebrew. 
             you going to translate from english to hebrew.
             your respond should be only the translate nothing else.
             i need you to think on the context from user not just colde translate. 
             i also need you figure sland of people . dont just transalte words but think how they use it and that translte.         
        """
        },
        
        {
            "role": "user", 
            "content":"translate this to hebrew: "+input_text
        },
        
    ],
    stream=True,
    temperature=1,
    max_completion_tokens=3000
    )
    # temptext = response.choices[0].delta.content
    # print(response)
    for chunk in response:
        if chunk.choices[0].delta.content is not None:  
            temptext = chunk.choices[0].delta.content
            text+=temptext
    print("chatgpt:")
    print(" "+text,end="",flush=True)      
    print("")

except Exception as e:
    pass
#     print("Translation failed. Error:", str(e))
